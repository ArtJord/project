<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel do Tempo ‚è∞</title>
  <style>
    :root{
      --bg1:#0077cc; --bg2:#00c6ff;
      --fg:#ffffff; --card-bg:rgba(255,255,255,.12); --shadow:rgba(0,0,0,.25);
      --btn-bg:#ffffff; --btn-fg:#0077cc; --btn-bg-hover:#005fa3; --btn-fg-hover:#fff;
    }
    [data-theme="dark"]{
      --bg1:#1d1f20; --bg2:#444;
      --fg:#f3f3f3; --card-bg:rgba(255,255,255,.08); --shadow:rgba(0,0,0,.35);
      --btn-bg:#2b2d2f; --btn-fg:#eaeaea; --btn-bg-hover:#3a3d40; --btn-fg-hover:#fff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
      flex-direction:column; gap:16px; text-align:center; color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      background:linear-gradient(135deg,var(--bg1),var(--bg2)); transition:background .4s ease;
      padding:24px;
    }
    h1{margin:0; font-size:2rem; letter-spacing:.5px}
    .grid{
      width:min(980px,100%); display:grid; gap:16px;
      grid-template-columns:1fr; 
    }
    @media (min-width: 820px){
      .grid{grid-template-columns: 1fr 1fr;}
      .wide{grid-column: 1 / -1;}
    }
    .card{
      background:var(--card-bg); border-radius:16px; padding:20px;
      box-shadow:0 10px 24px var(--shadow); backdrop-filter: blur(6px);
    }
    #relogio{font-size:4rem; font-weight:800; letter-spacing:2px}
    #data{opacity:.95; font-size:1.1rem; margin-top:8px}
    .row{display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:16px}
    button, .switch{
      border:none; cursor:pointer; border-radius:12px; padding:10px 16px; font-weight:700;
      background:var(--btn-bg); color:var(--btn-fg); transition:.25s; user-select:none;
    }
    button:hover, .switch:hover{background:var(--btn-bg-hover); color:var(--btn-fg-hover)}
    .switch{display:inline-flex; align-items:center; gap:8px}
    input[type="number"], input[type="text"]{
      padding:10px 12px; border-radius:10px; border:1px solid transparent; outline:none;
      background:var(--card-bg); color:var(--fg); min-width:120px;
    }
    .label{opacity:.9; font-size:.95rem}
    .muted{opacity:.8}
    .kpi{display:flex; align-items:center; justify-content:center; gap:12px; flex-wrap:wrap}
    .kpi .pill{
      background:var(--card-bg); padding:8px 12px; border-radius:999px; font-weight:600
    }
  </style>
</head>
<body>
  <h1>Painel do Tempo ‚è∞</h1>

  <!-- Rel√≥gio + Data -->
  <section class="card wide">
    <div id="relogio">00:00:00</div>
    <div id="data">‚Äî</div>
    <div class="row">
      <button id="btnTema">üåô Alternar Tema</button>
      <label class="switch">
        <input type="checkbox" id="chkAutoTema" /> Tema autom√°tico
      </label>
      <label class="switch">
        <input type="checkbox" id="chk12h" /> Formato 12h
      </label>
      <button id="btnCopiar">üìã Copiar hora</button>
    </div>
    <div class="kpi" style="margin-top:12px">
      <span class="pill" id="saudacao">Ol√°! üëã</span>
      <span class="pill" id="semana">Semana ‚Äî</span>
      <span class="pill" id="fuso">Fuso: <span id="tz"></span></span>
    </div>
  </section>

  <section class="grid">
    <!-- Cron√¥metro -->
    <div class="card">
      <h2>Cron√¥metro ‚è±Ô∏è</h2>
      <div id="cronometro" class="label" style="font-size:2rem; font-weight:800; margin:10px 0">00:00.00</div>
      <div class="row">
        <button id="startStop">Iniciar</button>
        <button id="lap" disabled>Volta</button>
        <button id="reset" disabled>Resetar</button>
      </div>
      <div id="voltas" class="label muted" style="margin-top:10px; max-height:140px; overflow:auto; text-align:left"></div>
    </div>

    <!-- Timer -->
    <div class="card">
      <h2>Timer ‚è≥</h2>
      <div class="row">
        <input id="minutos" type="number" min="0" placeholder="Minutos" />
        <input id="segundos" type="number" min="0" max="59" placeholder="Segundos" />
      </div>
      <div id="mostraTimer" class="label" style="font-size:2rem; font-weight:800; margin:10px 0">00:00</div>
      <div class="row">
        <button id="timerStart">Come√ßar</button>
        <button id="timerPause" disabled>Pausar</button>
        <button id="timerReset" disabled>Resetar</button>
      </div>
      <p class="muted" style="margin-top:8px">Dica: deixe 0m 10s para testar o alerta üîî</p>
    </div>
  </section>

  <script>
    // ===== Prefer√™ncias (localStorage) =====
    const store = {
      get(key, fallback){ try{ return JSON.parse(localStorage.getItem(key)) ?? fallback }catch{ return fallback } },
      set(key, val){ localStorage.setItem(key, JSON.stringify(val)) }
    };

    // ===== Rel√≥gio & Data =====
    const elRelogio = document.getElementById('relogio');
    const elData = document.getElementById('data');
    const elSaudacao = document.getElementById('saudacao');
    const elSemana = document.getElementById('semana');
    const elTZ = document.getElementById('tz');

    const chk12h = document.getElementById('chk12h');
    const chkAutoTema = document.getElementById('chkAutoTema');
    const btnTema = document.getElementById('btnTema');
    const btnCopiar = document.getElementById('btnCopiar');

    // estado inicial
    document.documentElement.setAttribute('data-theme', store.get('theme','light'));
    chk12h.checked = store.get('fmt12h', false);
    chkAutoTema.checked = store.get('autoTheme', true);

    function setTheme(theme){
      document.documentElement.setAttribute('data-theme', theme);
      store.set('theme', theme);
    }

    function autoTheme(){
      if(!chkAutoTema.checked) return;
      const h = new Date().getHours();
      const isDark = (h < 6 || h >= 18);
      setTheme(isDark ? 'dark' : 'light');
    }

    function two(n){ return n.toString().padStart(2,'0') }

    function formatClock(d){
      let h = d.getHours(), m = d.getMinutes(), s = d.getSeconds();
      if(chk12h.checked){
        const ampm = h >= 12 ? 'PM' : 'AM';
        h = h % 12 || 12;
        return `${two(h)}:${two(m)}:${two(s)} ${ampm}`;
      }
      return `${two(h)}:${two(m)}:${two(s)}`;
    }

    function weekNumber(d){
      // n√∫mero da semana ISO
      const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      const dayNum = date.getUTCDay() || 7;
      date.setUTCDate(date.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
      const weekNo = Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
      return weekNo;
    }

    function atualizarRelogio(){
      const now = new Date();
      elRelogio.textContent = formatClock(now);
      const opcoes = { weekday:'long', year:'numeric', month:'long', day:'numeric' };
      elData.textContent = now.toLocaleDateString('pt-BR', opcoes);

      const h = now.getHours();
      elSaudacao.textContent = h < 12 ? 'Bom dia ‚òÄÔ∏è' : (h < 18 ? 'Boa tarde üå§Ô∏è' : 'Boa noite üåô');

      elSemana.textContent = `Semana ${weekNumber(now)} üìÖ`;
      elTZ.textContent = Intl.DateTimeFormat().resolvedOptions().timeZone;

      autoTheme();
    }

    btnTema.onclick = () => {
      const cur = document.documentElement.getAttribute('data-theme');
      setTheme(cur === 'dark' ? 'light' : 'dark');
    };
    chk12h.onchange = () => store.set('fmt12h', chk12h.checked);
    chkAutoTema.onchange = () => store.set('autoTheme', chkAutoTema.checked);

    btnCopiar.onclick = async () => {
      try{
        await navigator.clipboard.writeText(elRelogio.textContent);
        btnCopiar.textContent = '‚úÖ Copiado!';
        setTimeout(()=> btnCopiar.textContent='üìã Copiar hora', 1000);
      }catch{
        alert('N√£o foi poss√≠vel copiar.'); 
      }
    };

    setInterval(atualizarRelogio, 1000);
    atualizarRelogio();

    // ===== Cron√¥metro =====
    const elCron = document.getElementById('cronometro');
    const elVoltas = document.getElementById('voltas');
    const btnStartStop = document.getElementById('startStop');
    const btnLap = document.getElementById('lap');
    const btnReset = document.getElementById('reset');

    let cronRunning = false, cronStart = 0, cronElapsed = 0, cronInt = null, voltaCount = 0;

    function renderCron(ms){
      const cs = Math.floor((ms % 1000) / 10);
      const s = Math.floor(ms / 1000) % 60;
      const m = Math.floor(ms / 60000);
      elCron.textContent = `${two(m)}:${two(s)}.${two(cs)}`;
    }

    function tickCron(){
      renderCron(cronElapsed + (Date.now() - cronStart));
    }

    btnStartStop.onclick = () => {
      if(!cronRunning){
        cronRunning = true;
        cronStart = Date.now();
        cronInt = setInterval(tickCron, 20);
        btnStartStop.textContent = 'Pausar';
        btnLap.disabled = false;
        btnReset.disabled = false;
      }else{
        cronRunning = false;
        clearInterval(cronInt);
        cronElapsed += Date.now() - cronStart;
        btnStartStop.textContent = 'Retomar';
      }
    };

    btnLap.onclick = () => {
      const ms = cronRunning ? (cronElapsed + (Date.now() - cronStart)) : cronElapsed;
      voltaCount++;
      const div = document.createElement('div');
      div.textContent = `Volta ${voltaCount}: ${elCron.textContent}`;
      elVoltas.prepend(div);
    };

    btnReset.onclick = () => {
      cronRunning = false; clearInterval(cronInt);
      cronElapsed = 0; voltaCount = 0; elVoltas.innerHTML='';
      renderCron(0);
      btnStartStop.textContent = 'Iniciar';
      btnLap.disabled = true; btnReset.disabled = true;
    };

    renderCron(0);

    // ===== Timer =====
    const inMin = document.getElementById('minutos');
    const inSeg = document.getElementById('segundos');
    const elMostraTimer = document.getElementById('mostraTimer');
    const tStart = document.getElementById('timerStart');
    const tPause = document.getElementById('timerPause');
    const tReset = document.getElementById('timerReset');

    let tTotal = 0, tRestante = 0, tInt = null, tRodando = false;

    function renderTimer(sec){
      sec = Math.max(0, Math.floor(sec));
      const m = Math.floor(sec / 60), s = sec % 60;
      elMostraTimer.textContent = `${two(m)}:${two(s)}`;
    }

    function terminarTimer(){
      clearInterval(tInt); tRodando = false;
      renderTimer(0);
      tPause.disabled = true;
      // toque simples usando Web Audio
      try{
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.type='sine'; o.frequency.value=880; o.connect(g); g.connect(ctx.destination);
        g.gain.setValueAtTime(0.001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime+0.01);
        o.start();
        setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.25); o.stop(ctx.currentTime+0.3); }, 250);
      }catch{}
      alert('‚è≥ Tempo encerrado!');
    }

    function tickTimer(){
      tRestante -= 1;
      renderTimer(tRestante);
      if(tRestante <= 0) terminarTimer();
    }

    tStart.onclick = () => {
      if(!tRodando){
        // se nunca configurado, pega dos inputs
        if(tRestante <= 0){
          const m = Math.max(0, parseInt(inMin.value||'0',10));
          const s = Math.max(0, parseInt(inSeg.value||'0',10));
          tTotal = m*60 + s;
          tRestante = tTotal;
          if(tTotal === 0){ alert('Defina um tempo primeiro üôÇ'); return; }
          renderTimer(tRestante);
        }
        tRodando = true;
        tInt = setInterval(tickTimer, 1000);
        tPause.disabled = false; tReset.disabled = false;
      }
    };

    tPause.onclick = () => {
      if(tRodando){ clearInterval(tInt); tRodando = false; }
      else if(tRestante > 0){ tRodando = true; tInt = setInterval(tickTimer, 1000); }
    };

    tReset.onclick = () => {
      clearInterval(tInt); tRodando = false;
      tRestante = 0; tTotal = 0; renderTimer(0);
      tPause.disabled = true; tReset.disabled = true;
    };

    renderTimer(0);
  </script>
</body>
</html>
